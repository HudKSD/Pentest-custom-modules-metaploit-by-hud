
# SCAN PLAYBOOK SCRIPT SETTINGS
# Hud_Custom_Enumerator.rc
# Author: Hud Seidu Daannaa (Web: www.daannaa.space)
# 
# This Metasploit RC-File could be used to portscan the network via nmap or via the internal portscanner module 

# RHOSTS is used from the global datastore
# PORTS is used from the global datastore

#https://secwiki.org/w/Running_nmap_as_an_unprivileged_user
#chmod 777 /usr/bin/nmap
#sudo setcap cap_net_raw,cap_net_admin,cap_net_bind_service+eip /usr/bin/nmap

<ruby>

#DB_STATUS_CHECK
begin
	framework.db.hosts
rescue ::ActiveRecord::ConnectionNotEstablished
	print_error("Database connection isn't established")
	return
end

#GLOBAL_PARAMETERS
rhosts = '192.168.1.1'
run_single("setg RHOSTS #{rhosts}")

#PARAMETER VALIDATION
print_line(" ")
print_line("[+] Parameter Validation ")
print_line(" ")
#Rhosts
if (framework.datastore['RHOSTS'] == nil)
	print_status("You have to set RHOSTS globally ... exiting")
	return
end

#SPECIFY OPERATIONS
ops = ['1','2']
for num in ops do
    if ( num == '1' )
        print_line(" ")
        print_status("Operations 1 activated")
        op1 = 1
    elsif ( num == '2' )
        print_status("Operations 2 activated")
        op2 = 1
    elsif ( num == '3' )
        print_status("Operations 3 activated")
        op3 = 1
    elsif ( num == '4' )
        print_status("Operations 4 activated")
        op4 = 1
    elsif ( num == '5' )
        print_status("Operations 5 activated")
        op5 = 1
    else
        print_status("You are not ready ...")
        print_line(" ")
    end
end  

#INTRODUCTION
print_line(" ")
print_line("Hud_Custom_Enumerator.rc")
print_line("Author: Hud Seidu Daannaa | Web: www.daannaa.space")
print_line("Starting enumerator ...")
print_line(" ")

if (op1 == 1)
    print_line(" ")
    print_status("OPERATION_1")
    print_line(" ")

    #OPERATION_1
    module = "auxiliary/scanner/smb/smb_version"
    print_line("[-] Module: #{module}")
    run_single("workspace -a #{module}")
    print_line("[-] Workspace created ...")
    print_line("[-] Target: #{framework.datastore['RHOSTS']}")
    print_line(" ")
    run_single("set THREADS 11")
    run_single("use #{module}")
    run_single("run -j")
    run_single("back")
    print_status("Done ...")
    print_status("_________________________________________")
end

if (op2 == 1)
    print_line(" ")
    print_status("OPERATION_2")
    print_line(" ")

    #OPERATION_2
    module = "auxiliary/scanner/ip/ipidseq"
    print_line("[-] Module: #{module}")
    run_single("workspace -a #{module}")
    print_line("[-] Workspace created ...")
    print_line("[-] Target: #{framework.datastore['RHOSTS']}")
    print_line(" ")
    run_single("set THREADS 100")
    run_single("use #{module}")
    run_single("run -j")
    run_single("back")
    print_status("e.g nmap -Pn -sI 192.168.1.1 192.168.1.2")
    print_status("Done ...")
    print_status("_________________________________________")
end

if (op3 == 1)
    print_line(" ")
    print_status("OPERATION_3")
    print_line(" ")

    #OPERATION_3
    module = "auxiliary/scanner/mssql/mssql_ping"
    print_line("[-] Module: #{module}")
    run_single("workspace -a #{module}")
    print_line("[-] Workspace created ...")
    print_line("[-] Target: #{framework.datastore['RHOSTS']}")
    print_line("")
    run_single("set THREADS 20")
    run_single("use #{module}")
    run_single("run -j")
    run_single("back")
    print_status("e.g nmap -Pn -sI 192.168.1.1 192.168.1.2")
    print_status("Done ...")
    print_status("_________________________________________")
end

if (op3 == 1)
    print_line(" ")
    print_status("OPERATION_3")
    print_line(" ")

    #OPERATION_3
    module = "auxiliary/scanner/ssh/ssh_version"
    print_line("[-] Module: #{module}")
    run_single("workspace -a #{module}")
    print_line("[-] Workspace created ...")
    print_line("[-] Target: #{framework.datastore['RHOSTS']}")
    print_line("")
    run_single("set THREADS 100")
    run_single("use #{module}")
    run_single("run -j")
    run_single("back")
    print_status("e.g nmap -Pn -sI 192.168.1.1 192.168.1.2")
    print_status("Done ...")
    print_status("_________________________________________")
end

if (op4 == 1)
    print_line(" ")
    print_status("OPERATION_4")
    print_line(" ")

    #OPERATION_3
    module = "auxiliary/scanner/ftp/ftp_version"
    print_line("[-] Module: #{module}")
    run_single("workspace -a #{module}")
    print_line("[-] Workspace created ...")
    print_line("[-] Target: #{framework.datastore['RHOSTS']}")
    print_line("")
    run_single("set THREADS 100")
    run_single("use #{module}")
    run_single("run -j")
    run_single("back")
    print_status("e.g nmap -Pn -sI 192.168.1.1 192.168.1.2")
    print_status("Done ...")
    print_status("_________________________________________")
end
</ruby>

