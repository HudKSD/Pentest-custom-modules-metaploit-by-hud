
# ======================================================================
# SCAN PLAYBOOK SCRIPT SETTINGS
# ======================================================================
# Hud_Custom_Scanner.rc
# Author: Hud Seidu Daannaa (Web: www.daannaa.space)
# 
# This Metasploit RC-File could be used to portscan the network via 
# nmap or via the internal portscanner module 

# RHOSTS is used from the global datastore
# PORTS is used from the global datastore

# https://secwiki.org/w/Running_nmap_as_an_unprivileged_user
# chmod 777 /usr/bin/nmap
# sudo setcap cap_net_raw,cap_net_admin,cap_net_bind_service+eip /usr/bin/nmap
# ======================================================================

<ruby>

#DB_STATUS_CHECK
begin
	framework.db.hosts
rescue ::ActiveRecord::ConnectionNotEstablished
	print_error("Database connection isn't established")
	return
end

#PORTS
common_ports = '1-1024'
all_ports = '1-65535'
custom_ports_0 = '21,22,23,25,43,50,53,67,68,79,80,109,110,111,123,135,137,138,139,143,161,264,265,389,443,445'
custom_ports_1 = '500,631,901,995,1241,1352,1433,1434,1521,1720,1723,3306,3389,3780,4662,5800,5801,5802,5803'
custom_ports_2 = '5900,5901,5902,5903,6000,6666,8000,8080,8443,10000,10043,27374,27665'
all_custom = '1-27665'
custom_5 = '1-4662'

#GLOBAL_PARAMETERS
rhosts = '212.123.6.254'
ports =  custom_5
run_single("setg PORTS #{ports}")
run_single("setg RHOSTS #{rhosts}")

#SPECIFY OPERATIONS
#ops = ['1','2','3','4','5','6','7']
ops = ['5']
for num in ops do
    if ( num == '1' )
        print_line(" ")
        print_status("Operations 1 activated")
        op1 = 1
    elsif ( num == '2' )
        print_status("Operations 2 activated")
        op2 = 1
    elsif ( num == '3' )
        print_status("Operations 3 activated")
        op3 = 1
    elsif ( num == '4' )
        print_status("Operations 4 activated")
        op4 = 1

    #default nmap settings
    elsif ( num == '5' )
        print_status("Operations 5 activated")
        op5 = 1

    #nmap firewall gymnastics
    elsif ( num == '6' )
        print_status("Operations 6 activated")
        op6 = 1

    #msfconsole's tcp port scanner    
    elsif ( num == '7' )
        print_status("Operations 6 activated")
        op7 = 1
    else
        print_status("You are not ready ...")
        print_line(" ")
    end
end  

#PARAMETER VALIDATION
print_line(" ")
print_line("[+] Parameter Validation ")
print_line(" ")
#Rhosts
if (framework.datastore['RHOSTS'] == nil)
	print_status("You have to set RHOSTS globally ... exiting")
	return
end
#Ports
if (framework.datastore['PORTS'] == nil)
	print_status("You have to set PORTS globally ...")
    print_status("Will use default settings ...")
	#return
else
    ports = '1-65535'
    run_single("setg PORTS #{ports}")
    
end

#INTRODUCTION
print_line(" ")
print_line("Hud_Custom_Scanner.rc")
print_line("Author: Hud Seidu Daannaa | Web: www.daannaa.space")
print_line("Starting scanner ...")
print_line(" ")

#OPERATION_1
if (op1 == 1)
    print_line(" ")
    print_status("OPERATION_1")
    print_line(" ")
    print_line("[-] Module: Db_Nmap")
    scan = 'sA'
    nmap_type = "Nmap_Scan_#{scan}"
    #nmapopts = "-#{scan} -Pn --reason -sV --version-light -O --osscan-guess --privileged --host-timeout 10m"
    nmapopts = "-#{scan} -Pn -sV -T4 --privileged"
    run_single("workspace -a #{nmap_type}")
    print_line("[-] Workspace created ...")
    print_line("[-] #{nmap_type} loading ...")
    print_line("[-] =======================================")
    print_line("[-] Applying Huds Custom Scripts, Switches & Settings")
    print_line("[-] Nmap Options: #{nmapopts}")
    print_line("[-] Target: #{framework.datastore['RHOSTS']}")
    print_line(" ")
    run_single("db_nmap #{framework.datastore['RHOSTS']} -p#{framework.datastore['PORTS']} #{nmapopts}")
    print_status("Done ...")
    print_status("_________________________________________")
end

#OPERATION_2
if (op2 == 1)
    print_line(" ")
    print_status("OPERATION_2")
    print_line(" ")
    print_line("[-] Module: Db_Nmap")
    scan = 'sU'
    nmap_type = "Nmap_Scan_#{scan}"
    #nmapopts = "-#{scan} -Pn --reason -sV --version-light -O --osscan-guess --privileged --host-timeout 10m"
    nmapopts = "-#{scan} -Pn -sV -T4 --privileged"
    run_single("workspace -a #{nmap_type}")
    print_line("[-] Workspace created ...")
    print_line("[-] #{nmap_type} loading ...")
    print_line("[-] =======================================")
    print_line("[-] Applying Huds Custom Scripts, Switches & Settings")
    print_line("[-] Nmap Options: #{nmapopts}")
    print_line("[-] Target: #{framework.datastore['RHOSTS']}")
    print_line(" ")
    run_single("db_nmap #{framework.datastore['RHOSTS']} -p#{framework.datastore['PORTS']} #{nmapopts}")
    print_status("Done ...")
    print_status("_________________________________________")
end

#OPERATION_3
if (op3 == 1)
    print_line(" ")
    print_status("OPERATION_3")
    print_line(" ")
    print_line("[-] Module: Db_Nmap")
    scan = 'sS'
    nmap_type = "Nmap_Scan_#{scan}"
    #nmapopts = "-#{scan} -Pn --reason -sV --version-light -O --osscan-guess --privileged --host-timeout 10m"
    nmapopts = "-#{scan} -Pn -T5 -sV --privileged"
    run_single("workspace -a #{nmap_type}")
    print_line("[-] Workspace created ...")
    print_line("[-] #{nmap_type} loading ...")
    print_line("[-] =======================================")
    print_line("[-] Applying Huds Custom Scripts, Switches & Settings")
    print_line("[-] Nmap Options: #{nmapopts}")
    print_line("[-] Target: #{framework.datastore['RHOSTS']}")
    print_line(" ")
    run_single("db_nmap #{framework.datastore['RHOSTS']} -p#{framework.datastore['PORTS']} #{nmapopts}")
    print_status("Done ...")
    print_status("_________________________________________")
end

#OPERATION_4
if (op4 == 1)
    print_line(" ")
    print_status("OPERATION_4")
    print_line(" ")
    print_line("[-] Module: Db_Nmap")
    scan = 'sT'
    nmap_type = "Nmap_Scan_#{scan}"
    #nmapopts = "-#{scan} -Pn --reason -sV --version-light -O --osscan-guess --privileged --host-timeout 10m --scan_delay 5ms"
    nmapopts = "-#{scan} -Pn -T4 -sV --privileged"
    run_single("workspace -a #{nmap_type}")
    print_line("[-] Workspace created ...")
    print_line("[-] #{nmap_type} loading ...")
    print_line("[-] =======================================")
    print_line("[-] Applying Huds Custom Scripts, Switches & Settings")
    print_line("[-] Nmap Options: #{nmapopts}")
    print_line("[-] Target: #{framework.datastore['RHOSTS']}")
    print_line(" ")
    run_single("db_nmap #{framework.datastore['RHOSTS']} -p#{framework.datastore['PORTS']} #{nmapopts}")
    print_status("Done ...")
    print_status("_________________________________________")
end

#OPERATION_5
#default nmap settings
if (op5 == 1)
    print_line(" ")
    print_status("OPERATION_5")
    print_line(" ")
    print_line("[-] Module: Db_Nmap")
    scan = 'Default'
    nmap_type = "Nmap_Scan_#{scan}"
    nmapopts = "-Pn -sV --privileged"
    run_single("workspace -a #{nmap_type}")
    print_line("[-] Workspace created ...")
    print_line("[-] #{nmap_type} loading ...")
    print_line("[-] =======================================")
    print_line("[-] Applying Huds Custom Scripts, Switches & Settings")
    print_line("[-] Nmap Options: #{nmapopts}")
    print_line("[-] Target: #{framework.datastore['RHOSTS']}")
    print_line(" ")
    run_single("db_nmap #{framework.datastore['RHOSTS']} -p#{framework.datastore['PORTS']} #{nmapopts}")
    print_status("Done ...")
    print_status("_________________________________________")
end

#OPERATION_6
#nmap firewall gymnastics
# ======================================================================
# Nmap firewall evasion techniques
# Scrapbook
# ======================================================================

# common_options='-Pn -p1-65535 -v --reason -sV --version-intensity -O'

# nmap $target $program_options --spoof-mac Cisco
# nmap $target $program_options -ff
# nmap $target $program_options --scan_delay 5ms
# nmap $target $program_options --host-timeout

# nmap $target $program_options --script=smb-check-vulns.nse
# nmap $target $program_options --script=samba-vuln-cve-2012-1182 -p 139
# nmap $target $program_options --script=http-enum
# nmap $target $program_options --script=smtp-strangeport
# nmap $target $program_options --script=http-php-version 
# nmap $target $program_options -sn --script dns-blacklist
# ======================================================================
if (op5 == 1)
    print_line(" ")
    print_status("OPERATION_5")
    print_line(" ")
    print_line("[-] Module: Db_Nmap")
    scan = 'Default'
    nmap_type = "Nmap_Scan_#{scan}"
    nmapopts = "-Pn -sV --privileged"
    run_single("workspace -a #{nmap_type}")
    print_line("[-] Workspace created ...")
    print_line("[-] #{nmap_type} loading ...")
    print_line("[-] =======================================")
    print_line("[-] Applying Huds Custom Scripts, Switches & Settings")
    print_line("[-] Nmap Options: #{nmapopts}")
    print_line("[-] Target: #{framework.datastore['RHOSTS']}")
    print_line(" ")
    run_single("db_nmap #{framework.datastore['RHOSTS']} -p#{framework.datastore['PORTS']} #{nmapopts}")
    print_status("Done ...")
    print_status("_________________________________________")
end

#OPERATION_7
#msfconsole's tcp port scanner
if (op7 == 1)
    print_line(" ")
    print_status("OPERATION_5")
    print_line(" ")
    module_ = 'auxiliary/scanner/portscan/tcp'
    print_line("Module: #{module_}")
    run_single("workspace -a #{module_}")
    print_line("[-] Workspace created ...")
    print_line("[-] Loading ...")
    print_line("[-] =======================================")
    print_line("[-] Applying Huds Custom Scripts, Switches & Settings")
    print_line("[-] Target: #{framework.datastore['RHOSTS']}")
	run_single("use #{module_}")
	run_single("set PORTS {framework.datastore['PORTS']}")    
	run_single("run -j")
	run_single("back")
    print_status("Please check jobs ...")
    print_status("_________________________________________")
end
   
</ruby>

